{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "storage_account_name": {
      "type": "string"
    },
    "subscription_id": {
      "type": "string"
    },
    "resource_group": {
      "type": "string"
    },
    "event_grid_topicName": {
      "type": "string"
    },
    "cap_gb_per_month": {
      "type": "int"
    }
  },
  "resources": [
    {
      "type": "Microsoft.Security/DefenderForStorageSettings",
      "apiVersion": "2022-12-01-preview",
      "name": "current",
      "properties": {
        "isEnabled": true,
        "malwareScanning": {
          "onUpload": {
            "isEnabled": true,
            "capGBPerMonth": "[parameters('cap_gb_per_month')]"
          },
          "scanResultsEventGridTopicResourceId": "[concat('/subscriptions/', parameters('subscription_id'), '/resourceGroups/', parameters('resource_group'), '/providers/Microsoft.EventGrid/topics/', parameters('event_grid_topicName'))]"
        },
        "sensitiveDataDiscovery": {
          "isEnabled": false
        },
        "overrideSubscriptionLevelSettings": true
      },
      "scope": "[resourceId('Microsoft.Storage/storageAccounts', parameters('storage_account_name'))]"
    }
  ],
  "outputs": {}
}
